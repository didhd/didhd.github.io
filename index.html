<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í…ì‚¬ìŠ¤ í™€ë¤ ì‹±ê¸€ í”Œë ˆì´ ì—°ìŠµ</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #bdc3c7);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
        }

        .container {
            width: 95%;
            max-width: 1200px;
        }

        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-area {
            position: relative;
            background-color: #ffffffcc;
            backdrop-filter: blur(5px);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 700px;
            margin-bottom: 20px;
        }

        .opponent-area,
        .player-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .opponent-area {
            order: 1;
            margin-bottom: 20px;
        }

        .player-area {
            order: 3;
            margin-top: 30px;
        }

        .community-cards {
            order: 2;
            display: flex;
            margin: 20px 0;
            transition: all 0.5s ease-in-out;
        }

        .player-cards,
        .opponent-cards,
        .community-cards {
            display: flex;
        }

        .card {
            width: 60px;
            height: 80px;
            border-radius: 5px;
            background-color: #eee;
            margin: 0 5px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: transform 0.4s, background-color 0.4s, box-shadow 0.4s;
        }

        .card:hover {
            transform: scale(1.1);
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .card.red {
            color: #c0392b;
        }

        .card.black {
            color: #2c3e50;
        }

        .card.back {
            background: linear-gradient(45deg, #999, #666);
            color: transparent;
            font-size: 2em;
        }

        .card.back::before {
            content: "â—†";
            color: #fff;
        }

        .chips-info {
            display: flex;
            flex-direction: row;
            justify-content: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .chips-info .tooltip {
            position: relative;
            cursor: help;
            margin-left: 5px;
        }

        .chips-info .tooltip .tooltiptext {
            visibility: hidden;
            width: 180px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 6px;
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .chips-info .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .action-buttons {
            margin: 20px 0;
            position: relative;
        }

        .action-buttons button {
            padding: 10px 15px;
            margin: 0 5px;
            border: none;
            background: #27ae60;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            font-size: 1em;
            transition: background 0.3s;
        }

        .action-buttons button:hover {
            background: #1e8449;
        }

        .action-buttons button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-tooltip {
            visibility: hidden;
            opacity: 0;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            bottom: 140%;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            transition: opacity 0.3s;
            font-size: 0.9em;
            z-index: 2;
            line-height: 1.4em;
        }

        .action-buttons button:hover .action-tooltip {
            visibility: visible;
            opacity: 1;
        }

        .pot,
        .message-area {
            font-size: 1.2em;
            margin: 10px 0;
        }

        .stage-indicator {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2em;
            font-weight: bold;
            background: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            color: #2c3e50;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: help;
        }

        .stage-indicator:hover {
            background: #f9f9f9;
        }

        .stage-indicator .stage-tooltip {
            visibility: hidden;
            opacity: 0;
            background-color: #333;
            color: #fff;
            padding: 6px;
            border-radius: 6px;
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            font-size: 0.9em;
            text-align: center;
            transition: opacity 0.3s;
            line-height: 1.4em;
        }

        .stage-indicator:hover .stage-tooltip {
            visibility: visible;
            opacity: 1;
        }

        .rules-area {
            background-color: #ffffffdd;
            backdrop-filter: blur(3px);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .rules-area h2 {
            margin-top: 0;
        }

        .tooltiptext {
            line-height: 1.4em;
        }

        .genie-advice {
            position: absolute;
            right: 20px;
            top: 20px;
            background: #f7f7f7aa;
            backdrop-filter: blur(3px);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            max-width: 200px;
            font-size: 0.9em;
        }

        .genie-advice h3 {
            margin: 0 0 5px 0;
            font-size: 1em;
            text-align: center;
        }

        .fade-in {
            opacity: 0;
            animation: fadein 0.8s forwards;
        }

        @keyframes fadein {
            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>í…ì‚¬ìŠ¤ í™€ë¤ ì‹±ê¸€ í”Œë ˆì´ ì—°ìŠµ</h1>
        <div class="game-area">
            <div class="stage-indicator" id="stage-indicator">
                í”„ë¦¬í”Œë
                <div class="stage-tooltip" id="stage-tooltip">
                    <strong>í˜„ì¬ ë¼ìš´ë“œ: í”„ë¦¬í”Œë</strong><br>
                    í™€ì¹´ë“œ 2ì¥ ë°°ë¶„ í›„ ì²« ë² íŒ… ë‹¨ê³„.<br>
                    ëª¨ë‘ ì½œí•˜ê±°ë‚˜ ì²´í¬í•˜ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.
                </div>
            </div>
            <div class="genie-advice" id="genie">
                <h3>ì§€ë‹ˆì˜ ì¡°ì–¸</h3>
                <div id="genie-message">ê²Œì„ ì‹œì‘</div>
            </div>

            <div class="opponent-area">
                <div class="chips-info">
                    ìƒëŒ€ ì¹©: <span id="opponent-stack">1000</span>
                    <span class="tooltip">ğŸ’°
                        <span class="tooltiptext">ìƒëŒ€ë°© í˜„ì¬ ì¹© ìˆ˜ëŸ‰</span>
                    </span>
                </div>
                <h2>ìƒëŒ€(ë”œëŸ¬)</h2>
                <div class="opponent-cards" id="opponent-cards"></div>
            </div>
            <div class="community-cards" id="community-cards"></div>
            <div class="player-area">
                <div class="chips-info">
                    ë‚´ ì¹©: <span id="player-stack">1000</span>
                    <span class="tooltip">ğŸ’°
                        <span class="tooltiptext">ë‚´ê°€ ë³´ìœ í•œ ì¹© ìˆ˜ëŸ‰</span>
                    </span>
                </div>
                <h2>í”Œë ˆì´ì–´</h2>
                <div class="player-cards" id="player-cards"></div>
                <div class="action-buttons">
                    <button onclick="playerCheck()">ì²´í¬
                        <div class="action-tooltip">ì¶”ê°€ ë² íŒ… ì—†ì´ ë„˜ê¹ë‹ˆë‹¤.<br>ì–‘ì¸¡ ì²´í¬ ì‹œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰.</div>
                    </button>
                    <button onclick="playerBet()">ë² íŒ…
                        <div class="action-tooltip">í˜„ì¬ ë² íŒ…ì´ ì—†ëŠ” ìƒíƒœì—ì„œ<br>ì²˜ìŒìœ¼ë¡œ ë² íŒ…ì„ ì‹œì‘í•©ë‹ˆë‹¤.</div>
                    </button>
                    <button onclick="playerCall()">ì½œ
                        <div class="action-tooltip">ìƒëŒ€ê°€ ë² íŒ…í•œ ê¸ˆì•¡ì— ë§ì¶”ì–´<br>ë‚´ ì¹©ì„ ëƒ…ë‹ˆë‹¤.</div>
                    </button>
                    <button onclick="playerRaise()">ë ˆì´ì¦ˆ
                        <div class="action-tooltip">ìƒëŒ€ ë² íŒ… ê¸ˆì•¡ë³´ë‹¤ ë” í°<br>ê¸ˆì•¡ì„ ë² íŒ…í•©ë‹ˆë‹¤.</div>
                    </button>
                    <button onclick="playerFold()">í´ë“œ
                        <div class="action-tooltip">íŒ¨ë¥¼ í¬ê¸°í•˜ê³  ì´ë²ˆ íŒì—ì„œ<br>ê¸°ê¶Œí•©ë‹ˆë‹¤.</div>
                    </button>
                </div>
                <div class="pot" id="pot-amount">íŒŸ: 0</div>
                <div class="message-area" id="message-area"></div>
            </div>
        </div>

        <div class="rules-area fade-in">
            <h2>ê²Œì„ ì§„í–‰ & ë² íŒ… ë¼ìš´ë“œ</h2>
            <p><strong>í—¤ì¦ˆì—… í…ì‚¬ìŠ¤ í™€ë¤</strong>: 2ì¸ í”Œë ˆì´. ìŠ¤ëª°ë¸”ë¼ì¸ë“œ(SB) 5ì¹©, ë¹…ë¸”ë¼ì¸ë“œ(BB) 10ì¹©ì„ ê²Œì‹œ í›„ ì‹œì‘.</p>
            <p>ì§„í–‰ ìˆœì„œ:</p>
            <ul>
                <li><strong>í”„ë¦¬í”Œë</strong>: í™€ì¹´ë“œ 2ì¥ í›„ ì²« ë² íŒ…</li>
                <li><strong>í”Œë</strong>: ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 3ì¥ ê³µê°œ í›„ ë² íŒ…</li>
                <li><strong>í„´</strong>: ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 4ë²ˆì§¸ ì¥ ê³µê°œ í›„ ë² íŒ…</li>
                <li><strong>ë¦¬ë²„</strong>: ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 5ë²ˆì§¸ ì¥ ê³µê°œ í›„ ë² íŒ…</li>
                <li><strong>ì‡¼ë‹¤ìš´</strong>: ëª¨ë“  ë² íŒ… ëë‚˜ë©´ íŒ¨ ë¹„êµ</li>
            </ul>
            <p>ê° ë‹¨ê³„ì—ì„œ ì½œ/ì²´í¬ë¡œ ë² íŒ… ê· í˜•ì´ ë§ìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.</p>
            <h2>ìš©ì–´</h2>
            <ul>
                <li>ì²´í¬: ì¶”ê°€ ë² íŒ… ì—†ì´ í„´ ë„˜ê¸°ê¸°</li>
                <li>ë² íŒ…: ë² íŒ…ì´ ì—†ëŠ” ìƒíƒœì—ì„œ ìƒˆë¡œ ë² íŒ… ì‹œì‘</li>
                <li>ì½œ: ìƒëŒ€ ë² íŒ… ì•¡ìˆ˜ì— ë§ì¶”ê¸°</li>
                <li>ë ˆì´ì¦ˆ: ìƒëŒ€ë³´ë‹¤ ë” í° ê¸ˆì•¡ ë² íŒ…</li>
                <li>í´ë“œ: íŒ¨ í¬ê¸°</li>
            </ul>
            <h2>ì¡±ë³´(ë†’ì€ìˆœ)</h2>
            <ul>
                <li>ë¡œì—´ ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‰¬</li>
                <li>ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‰¬</li>
                <li>í¬ì¹´ë“œ</li>
                <li>í’€í•˜ìš°ìŠ¤</li>
                <li>í”ŒëŸ¬ì‰¬</li>
                <li>ìŠ¤íŠ¸ë ˆì´íŠ¸</li>
                <li>íŠ¸ë¦¬í”Œ</li>
                <li>íˆ¬í˜ì–´</li>
                <li>ì›í˜ì–´</li>
                <li>í•˜ì´ì¹´ë“œ</li>
            </ul>
        </div>
    </div>

    <script>
        let deck = [];
        const suits = ["C", "D", "H", "S"];
        const values = ["2", "3", "4", "5", "6", "7", "8", "9", "T", "J", "Q", "K", "A"];

        let playerStack = 1000;
        let opponentStack = 1000;
        let pot = 0;
        let playerCards = [];
        let opponentCards = [];
        let communityCards = [];
        let gameStage = 'preflop';
        let gameOver = false;

        let currentBet = 0;
        let playerContribution = 0;
        let opponentContribution = 0;

        let smallBlind = 5;
        let bigBlind = 10;

        function createDeck() {
            deck = [];
            for (let s of suits) {
                for (let v of values) {
                    deck.push(v + s);
                }
            }
        }

        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // ì „í™˜ ì¤‘ ë²„íŠ¼ ëˆ„ë¥´ì§€ ì•Šë„ë¡ ì œì–´
        function disableAllButtons() {
            const buttons = document.querySelectorAll('.action-buttons button');
            buttons.forEach(b => b.disabled = true);
        }
        function enableAllButtons() {
            const buttons = document.querySelectorAll('.action-buttons button');
            buttons.forEach(b => b.disabled = false);
        }

        function startGame() {
            gameOver = false;
            communityCards = [];
            currentBet = 0;
            playerContribution = 0;
            opponentContribution = 0;
            gameStage = 'preflop';

            playerStack = 1000;
            opponentStack = 1000;

            // ë¸”ë¼ì¸ë“œ
            playerStack -= smallBlind;
            opponentStack -= bigBlind;
            pot = smallBlind + bigBlind;
            currentBet = bigBlind;

            createDeck();
            shuffleDeck();
            dealHoleCards();
            enableAllButtons();
            updateAllDisplays();
            setMessage("ìƒˆ ê²Œì„ ì‹œì‘! SB:5, BB:10");
            updateGenieMessage();
        }

        function dealHoleCards() {
            playerCards = [deck.pop(), deck.pop()];
            opponentCards = [deck.pop(), deck.pop()];
        }

        function updateAllDisplays() {
            updateStageIndicator();
            updatePlayerCardsDisplay();
            updateOpponentCardsDisplay();
            updateCommunityCardsDisplay();
            updatePotDisplay();
            updateStacksDisplay();
            updateGenieMessage();
        }

        function updateStacksDisplay() {
            document.getElementById('player-stack').textContent = playerStack;
            document.getElementById('opponent-stack').textContent = opponentStack;
        }

        function cardToDisplay(card) {
            const rankMap = { 'T': '10', 'J': 'J', 'Q': 'Q', 'K': 'K', 'A': 'A' };
            let rank = card[0];
            if (rankMap[rank]) rank = rankMap[rank];
            let suit = card[1];
            let suitChar, colorClass;
            switch (suit) {
                case 'C': suitChar = 'â™£'; colorClass = 'black'; break;
                case 'D': suitChar = 'â™¦'; colorClass = 'red'; break;
                case 'H': suitChar = 'â™¥'; colorClass = 'red'; break;
                case 'S': suitChar = 'â™ '; colorClass = 'black'; break;
            }
            return { text: rank + suitChar, color: colorClass };
        }

        function updatePlayerCardsDisplay() {
            const pc = document.getElementById('player-cards');
            if (!pc) return;
            pc.innerHTML = '';
            playerCards.forEach(card => {
                const { text, color } = cardToDisplay(card);
                let cardDiv = document.createElement('div');
                cardDiv.classList.add('card', color);
                cardDiv.textContent = text;
                pc.appendChild(cardDiv);
            });
        }

        function updateOpponentCardsDisplay() {
            const oc = document.getElementById('opponent-cards');
            if (!oc) return;
            oc.innerHTML = '';
            if (gameOver || gameStage === 'showdown') {
                opponentCards.forEach(card => {
                    const { text, color } = cardToDisplay(card);
                    const cardDiv = document.createElement('div');
                    cardDiv.classList.add('card', color);
                    cardDiv.textContent = text;
                    oc.appendChild(cardDiv);
                });
            } else {
                oc.innerHTML = `<div class="card back"></div><div class="card back"></div>`;
            }
        }

        function updateCommunityCardsDisplay() {
            const cc = document.getElementById('community-cards');
            if (!cc) return;
            cc.innerHTML = '';
            communityCards.forEach(card => {
                const { text, color } = cardToDisplay(card);
                const cardDiv = document.createElement('div');
                cardDiv.classList.add('card', color);
                cardDiv.textContent = text;
                cc.appendChild(cardDiv);
            });
            while (cc.childElementCount < 5) {
                const emptyCard = document.createElement('div');
                emptyCard.classList.add('card', 'back');
                emptyCard.textContent = '';
                cc.appendChild(emptyCard);
            }
        }

        function updatePotDisplay() {
            const potElem = document.getElementById('pot-amount');
            if (!potElem) return;
            potElem.textContent = `íŒŸ: ${pot}`;
        }

        function updateStageIndicator() {
            const si = document.getElementById('stage-indicator');
            const stt = document.getElementById('stage-tooltip');
            if (!si || !stt) return; // ìš”ì†Œ ì—†ìœ¼ë©´ ì•ˆì „ ì¢…ë£Œ

            let desc = '';
            switch (gameStage) {
                case 'preflop':
                    si.textContent = 'í”„ë¦¬í”Œë';
                    desc = 'í™€ì¹´ë“œ 2ì¥ ë°°ë¶„ í›„ ì²« ë² íŒ… ë‹¨ê³„.<br>ëª¨ë‘ ì½œ/ì²´í¬ ì‹œ í”Œë ì§„í–‰.';
                    break;
                case 'flop':
                    si.textContent = 'í”Œë';
                    desc = 'ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 3ì¥ ê³µê°œ í›„ ë² íŒ….<br>ì½œ/ì²´í¬ë¡œ ê· í˜• ë§ì¶”ë©´ í„´ìœ¼ë¡œ.';
                    break;
                case 'turn':
                    si.textContent = 'í„´';
                    desc = '4ë²ˆì§¸ ì¹´ë“œ ê³µê°œ í›„ ë² íŒ….<br>ì½œ/ì²´í¬ë¡œ ê· í˜• ë§ì¶”ë©´ ë¦¬ë²„ë¡œ.';
                    break;
                case 'river':
                    si.textContent = 'ë¦¬ë²„';
                    desc = '5ë²ˆì§¸ ì¹´ë“œ ê³µê°œ í›„ ë² íŒ….<br>ë§ˆì§€ë§‰ ë² íŒ… í›„ ì‡¼ë‹¤ìš´ ì§„í–‰.';
                    break;
                case 'showdown':
                    si.textContent = 'ì‡¼ë‹¤ìš´';
                    desc = 'ë² íŒ… ì¢…ë£Œ í›„ íŒ¨ ê³µê°œ, ìŠ¹ì ê²°ì •.';
                    break;
                default:
                    si.textContent = '';
            }
            stt.innerHTML = '<strong>í˜„ì¬ ë¼ìš´ë“œ: ' + si.textContent + '</strong><br>' + desc;
        }

        function setMessage(msg) {
            const msgArea = document.getElementById('message-area');
            if (!msgArea) return;
            msgArea.textContent = msg;
        }

        function updateGenieMessage() {
            const genie = document.getElementById('genie-message');
            if (!genie) return;
            if (gameOver) {
                genie.textContent = 'ë¼ìš´ë“œ ì¢…ë£Œ. ê³§ ìƒˆ ê²Œì„ ì‹œì‘';
                return;
            }
            let callAmount = currentBet - playerContribution;
            if (callAmount > 0) {
                genie.textContent = `ìƒëŒ€ ë² íŒ… ${callAmount}ì¹©. ì½œí•´ì„œ ë§ì¶”ê±°ë‚˜ ë ˆì´ì¦ˆ/í´ë“œ í•  ìˆ˜ ìˆì–´ìš”.`;
            } else {
                genie.textContent = `ì¶”ê°€ ë² íŒ… ì—†ìŒ. ì²´í¬í•˜ê±°ë‚˜ ë² íŒ…/ë ˆì´ì¦ˆë¥¼ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
            }
        }

        function playerFold() {
            if (gameOver) return;
            setMessage('í´ë“œ! ìƒëŒ€ ìŠ¹ë¦¬');
            opponentStack += pot;
            endHand();
        }

        function playerCheck() {
            if (gameOver) return;
            let callAmount = currentBet - playerContribution;
            if (callAmount > 0) {
                setMessage('ì²´í¬ ë¶ˆê°€! ì½œ ë˜ëŠ” í´ë“œí•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            setMessage('ì²´í¬');
            updateAllDisplays();
            opponentAction('check');
        }

        function playerBet() {
            if (gameOver) return;
            let callAmount = currentBet - playerContribution;
            if (callAmount > 0) {
                setMessage('ì½œ/í´ë“œ/ë ˆì´ì¦ˆ í•´ì•¼í•©ë‹ˆë‹¤. ë² íŒ… ë¶ˆê°€.');
                return;
            }
            let betSize = 20;
            if (playerStack < betSize) betSize = playerStack;
            playerStack -= betSize;
            playerContribution += betSize;
            pot += betSize;
            currentBet = playerContribution;
            setMessage(`ë² íŒ… ${betSize}ì¹©`);
            updateAllDisplays();
            opponentAction('bet', betSize);
        }

        function playerCall() {
            if (gameOver) return;
            let callAmount = currentBet - playerContribution;
            if (callAmount <= 0) {
                setMessage('ì½œí•  ë² íŒ…ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            if (playerStack < callAmount) callAmount = playerStack;
            playerStack -= callAmount;
            playerContribution += callAmount;
            pot += callAmount;
            setMessage(`ì½œ ${callAmount}ì¹©`);
            updateAllDisplays();
            checkRoundEndOrOpponentAction('call');
        }

        function playerRaise() {
            if (gameOver) return;
            let callAmount = currentBet - playerContribution;
            if (playerStack <= callAmount) {
                setMessage('ë ˆì´ì¦ˆ ë¶ˆê°€. ì¹© ë¶€ì¡±');
                return;
            }
            let raiseExtra = 20;
            let totalRaise = callAmount + raiseExtra;
            if (playerStack < totalRaise) totalRaise = playerStack;
            playerStack -= totalRaise;
            playerContribution += totalRaise;
            pot += totalRaise;
            currentBet = playerContribution;
            setMessage(`ë ˆì´ì¦ˆ ì´ ${totalRaise}ì¹©`);
            updateAllDisplays();
            opponentAction('raise', totalRaise - callAmount);
        }

        function checkRoundEndOrOpponentAction(playerMove) {
            if (playerContribution === opponentContribution) {
                endBettingRound();
            } else {
                opponentAction(playerMove);
            }
        }

        function opponentAction(playerMove, amount = 0) {
            if (gameOver) return;
            setTimeout(() => {
                let actionRand = Math.random();

                if (playerMove === 'check') {
                    if (actionRand < 0.5) {
                        setMessage('ìƒëŒ€ ì²´í¬');
                        opponentCheck();
                    } else {
                        opponentBet(20);
                    }
                } else if (playerMove === 'bet' || playerMove === 'raise') {
                    // ìƒëŒ€ ì½œ/í´ë“œ
                    if (actionRand < 0.5) {
                        opponentCall();
                    } else {
                        setMessage('ìƒëŒ€ í´ë“œ! í”Œë ˆì´ì–´ ìŠ¹ë¦¬');
                        playerStack += pot;
                        endHand();
                    }
                } else if (playerMove === 'call') {
                    if (actionRand < 0.5) {
                        setMessage('ìƒëŒ€ ì²´í¬');
                        opponentCheck();
                    } else {
                        opponentBet(20);
                    }
                }
            }, 1000);
        }

        function opponentCheck() {
            if (playerContribution === opponentContribution) {
                endBettingRound();
            } else {
                endBettingRound();
            }
        }

        function opponentBet(betSize) {
            if (opponentStack < betSize) betSize = opponentStack;
            opponentStack -= betSize;
            opponentContribution += betSize;
            pot += betSize;
            currentBet = opponentContribution;
            setMessage(`ìƒëŒ€ ë² íŒ… ${betSize}ì¹©`);
            updateAllDisplays();
        }

        function opponentCall() {
            let callAmount = currentBet - opponentContribution;
            if (opponentStack < callAmount) callAmount = opponentStack;
            opponentStack -= callAmount;
            opponentContribution += callAmount;
            pot += callAmount;
            setMessage(`ìƒëŒ€ ì½œ ${callAmount}ì¹©`);
            updateAllDisplays();
            endBettingRound();
        }

        function endBettingRound() {
            if (gameOver) return;
            currentBet = 0;
            playerContribution = 0;
            opponentContribution = 0;

            if (gameStage === 'preflop') {
                communityCards = [deck.pop(), deck.pop(), deck.pop()];
                gameStage = 'flop';
                setMessage('í”Œë ê³µê°œ');
            } else if (gameStage === 'flop') {
                communityCards.push(deck.pop());
                gameStage = 'turn';
                setMessage('í„´ ì¹´ë“œ ê³µê°œ');
            } else if (gameStage === 'turn') {
                communityCards.push(deck.pop());
                gameStage = 'river';
                setMessage('ë¦¬ë²„ ì¹´ë“œ ê³µê°œ');
            } else if (gameStage === 'river') {
                showDown();
                return;
            }
            updateAllDisplays();
        }

        function showDown() {
            gameStage = 'showdown';
            updateAllDisplays();
            const winner = determineWinner();
            if (winner === 'player') {
                setMessage('ì‡¼ë‹¤ìš´! í”Œë ˆì´ì–´ ìŠ¹!');
                playerStack += pot;
            } else if (winner === 'opponent') {
                setMessage('ì‡¼ë‹¤ìš´! ìƒëŒ€ ìŠ¹!');
                opponentStack += pot;
            } else {
                setMessage('ì‡¼ë‹¤ìš´! ë¬´ìŠ¹ë¶€! íŒŸ ë‚˜ëˆ„ê¸°');
                playerStack += pot / 2;
                opponentStack += pot / 2;
            }
            endHand();
        }

        function endHand() {
            gameOver = true;
            updateAllDisplays();
            disableAllButtons();
            setTimeout(() => {
                if (playerStack <= 0 || opponentStack <= 0) {
                    if (playerStack <= 0) setMessage('ë‚´ ì¹© ì†Œì§„! ê²Œì„ ì¢…ë£Œ!');
                    else setMessage('ìƒëŒ€ ì¹© ì†Œì§„! ë‹¹ì‹  ìŠ¹ë¦¬!');
                } else {
                    pot = 0;
                    startGame();
                }
            }, 3000);
        }

        function evaluateHand(cards) {
            const sortedCards = cards.slice().sort((a, b) => {
                const va = values.indexOf(a[0]);
                const vb = values.indexOf(b[0]);
                return va - vb;
            });
            const cardValues = sortedCards.map(c => values.indexOf(c[0]));
            const cardSuits = sortedCards.map(c => c[1]);
            const isFlush = cardSuits.every((s, i, arr) => s === arr[0]);
            const isStraight = cardValues.every((val, i) => i === 0 || val === cardValues[i - 1] + 1);
            const isRoyal = isStraight && cardValues[0] === 8;
            const valueCounts = {};
            cardValues.forEach(v => { valueCounts[v] = (valueCounts[v] || 0) + 1; });
            const counts = Object.values(valueCounts);
            const maxCount = Math.max(...counts);

            let rank = 0, high = 0;
            if (isRoyal && isFlush) { rank = 9; high = 14; }
            else if (isStraight && isFlush) { rank = 8; high = cardValues[4]; }
            else if (maxCount === 4) { rank = 7; high = cardValues.find(v => valueCounts[v] === 4); }
            else if (counts.includes(3) && counts.includes(2)) { rank = 6; high = cardValues.find(v => valueCounts[v] === 3); }
            else if (isFlush) { rank = 5; high = cardValues[4]; }
            else if (isStraight) { rank = 4; high = cardValues[4]; }
            else if (maxCount === 3) { rank = 3; high = cardValues.find(v => valueCounts[v] === 3); }
            else if (counts.filter(c => c === 2).length === 2) {
                rank = 2;
                let pairs = cardValues.filter(v => valueCounts[v] === 2);
                high = Math.max(...pairs);
            }
            else if (maxCount === 2) {
                rank = 1; high = cardValues.find(v => valueCounts[v] === 2);
            } else {
                rank = 0; high = cardValues[4];
            }
            return { rank, high };
        }

        function determineWinner() {
            const playerHand = playerCards.concat(communityCards);
            const opponentHand = opponentCards.concat(communityCards);
            const pr = evaluateHand(playerHand);
            const orr = evaluateHand(opponentHand);
            if (pr.rank > orr.rank) return 'player';
            else if (pr.rank < orr.rank) return 'opponent';
            else {
                if (pr.high > orr.high) return 'player';
                else if (pr.high < orr.high) return 'opponent';
                else return 'tie';
            }
        }

        document.addEventListener('DOMContentLoaded', startGame);
    </script>
</body>

</html>
